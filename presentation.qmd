---
title: Coffee Preferences
author: Brilliant Cassowary <br> Jinpeng Li, Joice Chen, Nidhi Soma, Stephen Syl-Akinwale 
date: today
format:
  revealjs: 
    theme: simple
execute:
  echo: false
---

## Introduce the topic and motivation

Coffee is one of the most popular choices for students across campus. We wanted to see if there were any trends we could analyze about coffee preferences at large.

General research question: How does coffee preference and consumption habits differ by demographic attributes such as age, gender, education level, race, and political identity?

## Introduce the data

- Data collected from James Hoffman's "The Great American Coffee Taste Test"

- Surveyed almost 4000 respondents about their coffee preferences
- Participants were required weighing scale,a way of heating hot water, 
and cups that can accommodate about 250 mLs or eight ounces
- Coffee A - Light roast, Washed, Coffee B - Medium Roast, Coffee C - Dark roast, Coffee D - Fermented, Natural, Fruity

## Highlights from EDA

Looking at these variables we can see age ranges 25-34 are the most avid coffee drinkers. We want to see more about their taste preferences.
```{r}
library(tidyverse)
library(janitor)
library(dplyr)
library(skimr)
library(stringr)
library(ggplot2)
library(usethis)
library(tidymodels)
library(probably)
coffee_clean_factors<- read_rds("data/coffee_clean_factor.rds")
#age vs  roast
#coffee like or not by age
roast_totals <- coffee_clean_factors |>
  group_by(roast_level) |>
  summarise(total = n())

age_roast_counts <- coffee_clean_factors |>
  filter(!is.na(roast_level) & !is.na(age)) |>
  group_by(age, roast_level) |>
  summarise(count = n()) |>
  left_join(roast_totals, by = "roast_level") |>
  mutate(percentage = count / total * 100)

ggplot(age_roast_counts, aes(x = roast_level, y = percentage, fill = age)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(title = "Coffee Roast Level Preferences by Age Group",
       x = "Roast Level",
       y = "Percentage") +
  theme_minimal() +
  scale_fill_viridis_d(end = 0.8)
```

## Educational 
```{r}
#Education vs number of sweetners

sweet_edu_df <- coffee_clean_factors |>
  select(education_level, contains("sugar_sweetener_add")) |>
  drop_na()
names(sweet_edu_df) <- gsub("sugar_sweetener_add_", "", names(sweet_edu_df))
sweet_edu_df <- sweet_edu_df |> 
  mutate(education_level = case_when(
    education_level %in% c("Bachelor's degree", "Master's degree", "Doctorate or professional degree") ~ "bachelor",
    TRUE ~ "no_bachelor"
  )) |>
  mutate(education_level = factor(education_level,
                                  c("bachelor",
                                    "no_bachelor")))

sweet_edu_df2 <- sweet_edu_df |>
  pivot_longer(
    cols = 2:9,
    names_to = "sweetener",
    values_to = "add"
  ) 
sweet_edu_df2 |>
  ggplot(aes(y = sweetener, fill = add) ) +
  geom_bar(position = "fill") +
  facet_wrap(.~education_level)

```

## Hypothesis 1: Inference for Roast Level

```{r}
#| label: lin-reg-all-prefs
  young_roast_reg<-  coffee_clean_factors |>
  select(age, roast_level) |>
  drop_na() |>
    mutate(roast_level_num = ifelse(roast_level == "Light" | roast_level == "Medium" | roast_level == "Nordic", 1, 0))
  
young_roast_fit <- linear_reg() |>
fit(roast_level_num ~ age, data = young_roast_reg)
tidy(young_roast_fit)

# glance(young_roast_fit)$adj.r.squared
#for diff of props, the output is saying one group is % more probable than the other
#topic modeling for text-analysis?
```

- Model predicts that people aged 18-24 years old will have a 0.029 lower proportion of people that prefer lighter roasts than people aged 25-34 years old, on average. 

- Younger people aged 18-24 are actually not the most likely group to prefer lighter roasts?

## Hypothesis 1: Visualizing Lighter/Darker Roasts

```{r}
#| label: show-independence-relationship
young_roast_binary <-young_roast_reg |>
  mutate(roast_level_binary = fct_collapse(
.f = roast_level,
Lighter = c("Light", "Medium", "Nordic"),
other_level = "Darker"))
  ggplot(young_roast_binary, mapping = aes(x = age, fill = roast_level_binary)) +
  geom_bar(position = "fill") +
    scale_fill_viridis_d() +
    theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

If there were no relationship between these two variables, we would expect to see the purple bars reaching to the same height, regardless of age group. We need to conduct a chi-squared test of independence to see if the differences we see here are just random noise or a meaningful relationship.

## Hypothesis 1: Chi squared test for Roast Level

Null hypothesis: There is no association between age group and a lighter roast level preference.

Alternative hypothesis: There is an association between age group and a lighter roast level preference.

```{r}
#| label: chi-sqr-test
#source: https://infer.netlify.app/articles/chi_squared
# calculate the observed statistic
observed_indep_statistic <- young_roast_binary %>%
  specify(roast_level_binary ~ age) %>%
  hypothesize(null = "independence") %>%
  calculate(stat = "Chisq")

# generate the null distribution using randomization
null_dist_roast <- young_roast_binary %>%
  specify(roast_level_binary ~ age) %>%
  hypothesize(null = "independence") %>%
  generate(reps = 5000, type = "permute") %>%
  calculate(stat = "Chisq")

# visualize the null distribution and test statistic!
null_dist_roast %>%
  visualize() + 
  shade_p_value(observed_indep_statistic,
                direction = "greater")

# calculate the p value from the observed statistic and null distribution
p_value_independence <- null_dist_roast %>%
  get_p_value(obs_stat = observed_indep_statistic,
              direction = "greater")

p_value_independence

```

## Hypothesis 2: Hypothesis Test for Sweetener Preference

Null hypothesis: The true average number of types of sweetener preferred is the same between people in America with a Bachelor's degree or higher and people without a Bachelor's degree.

Alternative hypothesis: The true average number of types of sweetener preferred is not the same between people in America with a Bachelor's degree or higher and people without a Bachelor's degree.

```{r}
#| label: 2sample-statistics-sweetener
#clean original dataset
sweet_edu_df <- coffee_clean_factors |>
  select(education_level, contains("sugar_sweetener_add")) |>
  drop_na()
names(sweet_edu_df) <- gsub("sugar_sweetener_add_", "", names(sweet_edu_df))
sweet_edu_df <- sweet_edu_df |> 
  mutate(education_level = case_when(
    education_level %in% c("Bachelor's degree", "Master's degree", "Doctorate or professional degree") ~ "bachelor",
    TRUE ~ "no_bachelor"
  )) |>
  mutate(education_level = factor(education_level,
                                  c("bachelor",
                                    "no_bachelor")))

#data set for analysis, with number of sugar types
sweet_edu_df_analysis <- sweet_edu_df |>
  rowwise() |>
  mutate(sweet_count = sum(across(granulated_sugar:raw_sugar), na.rm = TRUE))

sweet_edu_df_analysis |>
  group_by(education_level) |>
   summarize(mean = mean(sweet_count))
```

The observed statistic is 1.455-1.408 = 0.047

## Hypothesis 2: Hypothesis Test for Sweetener Preference 

```{r}
#Hypothesis testing
#| label: 2sample-statistics-sweetener2

ob_sweet <- sweet_edu_df_analysis |>
  specify(response = sweet_count, explanatory = education_level) |>
  hypothesize(null = "independence") |>
  calculate(stat = "diff in means")

# null distribution
null_dist_sweet <- sweet_edu_df_analysis |>
  specify(response = sweet_count, explanatory = education_level) |>
  hypothesize(null = "independence") |>
  generate(reps = 1000, type = "permute") |>
  calculate(stat = "diff in means")

# visualize the null distribution and test statistic
null_dist_sweet |>
  visualize() + 
  shade_p_value(ob_sweet,
                direction = "greater")

# calculate the p value from the observed statistic and null distribution
p_value <- null_dist_sweet |>
  get_p_value(obs_stat = ob_sweet,
              direction = "greater")

p_value
```
The hypothesis test resulted in a p-value of 0.35, which is larger than the critical value of 0.05. This high p-value indicates that we do not have sufficient evidence to reject the null hypothesis.

## Conclusions + future work



## Limitations
- Answers were not mandatory so there were a lot of absent values
- It was only conducted in the US
- Because Measurements were not uniformly recorded, it is likely respondents misrepresented their measurements.
- It was provided by cometncer coffee company, it is possible their roasts are very different from other brands
- The population available are already avid coffee drinkers so there might be bias to some of their responses.
