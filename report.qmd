---
title: "Coffee Preferences"
subtitle: "Brilliant Cassowary - Report Draft"
author:
  - "Nidhi Soma (ns848)"
  - "Joice Chen (jc3528)"
  - "Jinpeng Li (jl3496)"
  - "Stephen Syl-Akinwale (sis33)"
echo: false
warning: false
message: false
fig-width: 5
fig-height: 3
---


# Introduction
One of the most widely known beverages in today's age is coffee. It is present in many different settings, ranging from students and employees to casual coffee shop frequenters and critical coffee enthusiasts.
Our current research questions are:
- How does coffee preference and consumption habits differ by demographic
attributes such as age, gender, education level, race, and political identity?
```{r}
# - How does self-perceived coffee experience affect actual and stated
# preferences?
```


# Data description
*What are the observations (rows) and the attributes (columns)?*

The observations represent an individual respondent to the survey. There are 4,042 rows. The columns are questions that they answered, ranging from demographic data to coffee preferences. There are 98 of these columns.

*Why was this dataset created?*

To understand the general public's preferences as consumers for coffee. Additionally, since Cometeer funded the creation of this dataset, they may be interested to know people's preferences in order to make their coffee capsules more appealing to a wider market.

*Who funded the creation of the dataset?*

World champion barista James Hoffmann and Cometeer – a subscription service that makes flash-frozen coffee capsules.

*What processes might have influenced what data was observed and recorded and what was not?*

The survey quickly was sold out, and Hoffman's audience in general is coffee specialists. That will likely skew the population surveyed to be people who likely prefer specialty coffee, so it may be a biased sample. Additionally, this survey was conducted through people ordering tasting kits online, which were then sent to the participants to prepare and complete voluntarily, so there may have been differences in that. One example is that because participants were following a livestream to demonstrate how to do their taste test, their coffees may have been out long enough to have cooled, which could be another unaccounted variable that affected their taste preferences.

*What preprocessing was done, and how did the data come to be in the form that you are using?*

Zip codes and geographic data seemed to have been removed. Participants were anonymized to protect their privacy. It wasn't disclosed how Hoffmann and his team collected all the taste test results that participants filled out, but once they got that data, they made it into a spreadsheet to be shared with the public.

*If people are involved, were they aware of the data collection and if so, what purpose did they expect the data to be used for?*

People were involved, and they were made aware of the data collection by a YouTube video stating that the purpose of this taste test was to understand coffee preferences in the USA. The participants had to order the coffee tasting kit on their own in order to participate, showing their willingness to accept these terms. Hoffmann also made his intentions clear in his video with why he wanted to collect the data, and that he was planning to publicize the raw data later on.


*Are relationships between individual instances made explicit?*

There are no explicit relationships between individual instances because the data provided is it's sole instance.

*Are there recommended data splits?*

No there are no recommended Data splits in this collection.

```{r}
# *Are there any errors, sources of noise, or redundancies in the dataset?*
# There are instances of
```

*Does the dataset contain data that might be considered confidential?*

Possibly demographic information, such as political affiliation, age, gender, education level.

*Does the dataset identify any subpopulations (e.g., by age, gender)?*

Yes,the great America Coffee taste separated entries into sub-populations at the discretion of the participant

*Is it possible to identify individuals, either directly or indirectly from the dataset?*

No the identity of each participant was anonymized.

*What mechanisms or procedures were used to collect the data?*

Participants who participated  of the great American Coffee test recieved an event kit includes four different coffees from four different roasters that will be chemically identical if used with distilled water at the same ratio.Participants will need a weighing scale, a way of heating hot water, and cups that can accommodate about 250 mLs or eight ounces.The event is only available in the US, but the organizers are interested in conducting similar events in other regions.

*Were the individuals in question notified about the data collection?*

The data was self reported and as a result consensual to each participant.

*Was any preprocessing/cleaning/labeling of the data done *

Yes data cleaning was done to make the variables and fields more readable and humanly understandably.

*Was the “raw” data saved in addition to the preprocessed/cleaned/labeled data*

Yes the raw data is stored in our repository and can still be accessed through this link publicly ( https://bit.ly/gacttCSV+)

*Is there anything about the composition of the dataset or the way it was collected and leaned/labeled that might impact future uses? *

The data was collected by individuals all over the US. There fore there may be inconsistencies with recording the data since there were no qualifications or standardized way of verifying results, except form participants practices.


*Notes*

Coffee A - Light roast, Washed
Coffee B - Medium Roast
Coffee C - Dark roast
Coffee D - Fermented, Natural, Fruity
Detailed description on task and methods used to collect the data(https://www.youtube.com/watch?v=1fN_z4-EcOU)

*Loading data*

```{r}
#| label: loading packages
library(tidyverse)
library(janitor)
library(dplyr)
library(skimr)
library(stringr)
library(ggplot2)
library(usethis)
library(tidymodels)
library(probably)
```
```{r}
#| label: loading-cleaned-data
coffee_df<-read_csv("data/GACTT_RESULTS_ANONYMIZED_v2.csv")

#remove NA columns
coffee_clean <- coffee_df |>
  select(-contains("flavorings")) |>
  select(-contains("Gender (please specify"))

#remove repetitive questions
coffee_clean <- coffee_clean |>
  mutate(`Where do you typically drink coffee?` = NULL) |>
  mutate(`How do you brew coffee at home?` = NULL)|>
  mutate(`On the go, where do you typically purchase coffee?` = NULL) |>
  mutate(`Do you usually add anything to your coffee?` = NULL) |>
  mutate(`What kind of diary do you add?` = NULL) |>
  mutate(`What kind of sugar or sweetener do you add?` = NULL) |>
  mutate(`Why do you drink coffee?` = NULL)

original_names <- colnames(coffee_clean)
tidy_names <- gsub(" ", "_", original_names)
tidy_names <- tolower(tidy_names)
tidy_names <- gsub("[[:punct:]]&&[^_]", "", tidy_names)

colnames(coffee_clean) <- tidy_names

#renaming
coffee_clean <- coffee_clean |>
  rename(
    age = "what_is_your_age?",
    cups_of_coffee_per_day = "how_many_cups_of_coffee_do_you_typically_drink_per_day?",
    how_else_at_home = "how_else_do_you_brew_coffee_at_home?",
    where_else_purchase_coffee = "where_else_do_you_purchase_coffee?",
    favorite_coffee_drink = "what_is_your_favorite_coffee_drink?",
    favorite_coffee = "please_specify_what_your_favorite_coffee_drink_is", 
    prefer_between_abc = "between_coffee_a,_coffee_b,_and_coffee_c_which_did_you_prefer?", 
    other_flavoring = "what_other_flavoring_do_you_use?", 
    best_described_before = "before_today's_tasting,_which_of_the_following_best_described_what_kind_of_coffee_you_like?", 
    like_coffee = "how_strong_do_you_like_your_coffee?", 
    roast_level = "what_roast_level_of_coffee_do_you_prefer?", 
    caffeine = "how_much_caffeine_do_you_like_in_your_coffee?", 
    own_coffee_expertise = "lastly,_how_would_you_rate_your_own_coffee_expertise?", 
    prefer_between_ad = "between_coffee_a_and_coffee_d,_which_did_you_prefer?", 
    favorite_overall_coffee = "lastly,_what_was_your_favorite_overall_coffee?", 
    time_spent_on_equipment = "approximately_how_much_have_you_spent_on_coffee_equipment_in_the_past_5_years?", 
    good_value_equipment = "do_you_feel_like_you’re_getting_good_value_for_your_money_with_regards_to_your_coffee_equipment?"
  )

colnames(coffee_clean) <- sapply(colnames(coffee_clean), function(name) {
  if (grepl("where_do_you_typically_drink_coffee", name)) {
    name <- gsub("where_do_you_typically_drink_coffee\\?_\\((.*)\\)", "drink_\\1", name)
  } else if (grepl("how_do_you_brew_coffee_at_home", name)) {
    name <- gsub("how_do_you_brew_coffee_at_home\\?_\\((.*)\\)", "at_home_\\1", name)
  } else if (grepl("on_the_go,_where_do_you_typically_purchase_coffee", name)) {
    name <- gsub("on_the_go,_where_do_you_typically_purchase_coffee\\?_\\((.*)\\)", "purchase_\\1", name)
  } else if (grepl("do_you_usually_add_anything_to_your_coffee", name)) {
    name <- gsub("do_you_usually_add_anything_to_your_coffee\\?_\\((.*)\\)", "add_to_\\1", name)
  } else if (grepl("what_kind_of_dairy_do_you_add", name)) {
    name <- gsub("what_kind_of_dairy_do_you_add\\?_\\((.*)\\)", "dairy_add_\\1", name)
  } else if (grepl("what_kind_of_sugar_or_sweetener_do_you_add", name)) {
    name <- gsub("what_kind_of_sugar_or_sweetener_do_you_add\\?_\\((.*)\\)", "sugar_sweetener_add_\\1", name)
  } else if (grepl("why_do_you_drink_coffee", name)) {
    name <- gsub("why_do_you_drink_coffee\\?_\\((.*)\\)", "reason_\\1", name)
  }
  name
}
)

#manually changing some more confusing names
coffee_clean_2 <- coffee_clean |>
  rename(at_home_coffee_brewing_machine = `at_home_coffee_brewing_machine_(e.g._mr._coffee)`,
         at_home_pod_or_capsule_machine = `at_home_pod/capsule_machine_(e.g._keurig/nespresso)`,
         at_home_coffee_extract = `at_home_coffee_extract_(e.g._cometeer)`,
         purchase_national_chain = `purchase_national_chain_(e.g._starbucks,_dunkin)`,
         add_to_none = `add_to_no_-_just_black`,
         add_to_milk = `add_to_milk,_dairy_alternative,_or_coffee_creamer`,
         sugar_sweetener_add_artificial_sweeteners = `sugar_sweetener_add_artificial_sweeteners_(e.g.,_splenda)`,
         sugar_sweetener_add_raw_sugar= `sugar_sweetener_add_raw_sugar_(turbinado)`,
         where_work = `do_you_work_from_home_or_in_person?`,
         monthly_coffee_cost = `in_total,_much_money_do_you_typically_spend_on_coffee_in_a_month?`,
         like_taste = `do_you_like_the_taste_of_coffee?`,
         know_where_coffee_from = `do_you_know_where_your_coffee_comes_from?`,
         most_pay = `what_is_the_most_you've_ever_paid_for_a_cup_of_coffee?`,
         most_willing_pay = `what_is_the_most_you'd_ever_be_willing_to_pay_for_a_cup_of_coffee?`,
         good_value_money = `do_you_feel_like_you’re_getting_good_value_for_your_money_when_you_buy_coffee_at_a_cafe?`) |>
  mutate(`what_kind_of_dairy_do_you_add?` = NULL)

#change type to categorical

coffee_clean_factors <- coffee_clean_2 |>
  mutate(age = factor(age),
         monthly_coffee_cost = factor(monthly_coffee_cost))|>
  mutate(across(like_taste:political_affiliation, factor)) |>
  mutate(across(like_coffee:caffeine, factor)) |>
  mutate(cups_of_coffee_per_day = as_factor(cups_of_coffee_per_day))|>
  mutate(best_described_before = factor(best_described_before))

#add category
coffee_clean_factors <- coffee_clean_factors |>
  mutate(age = fct_relevel(age, c("<18 years old",
                                  "18-24 years old",
                                  "25-34 years old",
                                  "35-44 years old", 
                                  "45-54 years old",
                                  "55-64 years old",
                                  ">65 years old")))|>
  mutate(monthly_coffee_cost = fct_relevel(monthly_coffee_cost, c(
    "<$20",
    "$20-$40",
    "$40-$60",
    "$60-$80",
    "$80-$100",
    ">$100"))) |>
  mutate(most_pay = fct_relevel(
    most_pay,
    c("Less than $2",
    "$2-$4",
    "$4-$6",
    "$6-$8",
    "$8-$10",
    "$10-$15",
    "$15-$20",
    "More than $20"
   ))) |>
  mutate(most_willing_pay = fct_relevel(
    most_willing_pay,
    c("Less than $2",
    "$2-$4",
    "$4-$6",
    "$6-$8",
    "$8-$10",
    "$10-$15",
    "$15-$20",
    "More than $20"
  ))) |>
  mutate(cups_of_coffee_per_day = fct_relevel(cups_of_coffee_per_day,
                                              c("Less than 1",
                                              "1",
                                              "2",
                                              "3",
                                              "4",
                                              "More than 4"))) |>
  mutate(caffeine = fct_relevel(caffeine,
                                c("Decaf", "Half caff", "Full caffeine"))) |>
  mutate(like_coffee = fct_relevel(like_coffee,
                                   c("Weak",
                                     "Somewhat light",
                                     "Medium",
                                     "Somewhat strong",
                                     "Very strong")))

```

# Data analysis

*Pre-registered hypotheses*

Our first pre-registered hypothesis was that younger people 18 - 25 prefer their coffee with lighter roasts.
```{r}
#| label: visual-hyp-prefs
# test <- coffee_clean_factors |>
#   select(age, favorite_coffee_drink, favorite_coffee, best_described_before, like_coffee, roast_level, prefer_between_abc, prefer_between_ad, favorite_overall_coffee)

  coffee_clean_factors |>
  select(age, roast_level) |>
  drop_na() |>
  filter(age == "18-24 years old") |>
  ggplot(aes(x = roast_level, fill = age)) +
  geom_bar() +
  scale_fill_viridis_d() +
  theme_minimal() +
  theme(legend.position = "none") +
  labs(
    title = "Roast Level Preferences",
    subtitle = "For respondents aged 18-24 only",
    x= "Roast level",
    y = "Frequency"
  )
```
We see that there is a clear peak around the Light and Medium roast levels, suggesting that in this sample, younger people that are 18-24 years old have a strong preference for Light and Medium roast levels. However, there is more of a preference for Dark roasts than Nordic roasts, even though Nordic roasts are also generally considered to be lighter roasts.

This leads to the question of whether the younger age range of 18-24 is the most likely age to prefer lighter roast levels (Light, Medium, or Nordic). We investigate this below by first visualizing the preferences of all the age ranges, and then using a linear regression model. 
```{r}
#| label: visual-all-prefs
#| fig-width: 8
#| fig-height: 6
coffee_clean_roast <- coffee_clean %>%
  mutate(roast_level = ifelse(is.na(roast_level), "No Preference", roast_level))

ggplot(coffee_clean_roast, aes(x = age, fill= roast_level)) +
  geom_bar(position = "dodge") +
  labs(title = "Preferred Coffee Roast Levels",
       x = "Age Group",
       y = "Frequency",
       fill= "Roast preference") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
 scale_fill_viridis_d()
```
In the future, exploring a logistic regression model may also lead to more accurate results, since the data when visualized doesn't appear to be very linear.
```{r}
#| label: lin-reg-all-prefs
  young_roast_reg<-  coffee_clean_factors |>
  select(age, roast_level) |>
  drop_na() |>
    mutate(roast_level_num = ifelse(roast_level == "Light" | roast_level == "Medium" | roast_level == "Nordic", 1, 0))
  
young_roast_fit <- linear_reg() |>
fit(roast_level_num ~ age, data = young_roast_reg)
tidy(young_roast_fit)

# glance(young_roast_fit)$adj.r.squared
#for diff of props, the output is saying one group is % more probable than the other
#topic modeling for text-analysis?
```
Each of the coefficients gives the proportion of people choosing lighter roasts for the corresponding age group relative to the reference level of <18 years old. The reference level has a coefficient of 0, meaning its estimated proportion is the intercept, 0.842. Notably, the model predicts that people aged 18-24 years old will have a 0.029 lower proportion of people that prefer lighter roasts than people aged 25-34 years old, on average. So, the model predicts that younger people aged 18-24 are actually not the most likely group to prefer lighter roasts.


*Pre-registered Hypothesis 2*
Our second pre-registered hypothesis was that people who have higher levels of education are less likely to prefer their coffee with added sweetener. We can visualize this data to see if there seem to be any trends.

```{r}
#| label: 2data-visualization
#clean original dataset
sweet_edu_df <- coffee_clean_factors |>
  select(education_level, contains("sugar_sweetener_add")) |>
  drop_na()
names(sweet_edu_df) <- gsub("sugar_sweetener_add_", "", names(sweet_edu_df))
sweet_edu_df <- sweet_edu_df |> 
  mutate(education_level = case_when(
    education_level %in% c("Bachelor's degree", "Master's degree", "Doctorate or professional degree") ~ "bachelor",
    TRUE ~ "no_bachelor"
  )) |>
  mutate(education_level = factor(education_level,
                                  c("bachelor",
                                    "no_bachelor")))

#data set for analysis, with number of sugar types
sweet_edu_df_analysis <- sweet_edu_df |>
  rowwise() |>
  mutate(sweet_count = sum(across(granulated_sugar:raw_sugar), na.rm = TRUE))

#other dataset for visualization purposes
sweet_edu_df2 <- sweet_edu_df |>
  pivot_longer(
    cols = 2:9,
    names_to = "sweetener",
    values_to = "add"
  ) 

sweet_edu_df3 <- sweet_edu_df2 |>
  select(education_level, sweetener, add)|>
  filter(add == TRUE)

sweet_edu_df <- sweet_edu_df
  
#Popularity of sweeteners
sweet_edu_df2 |>
  ggplot(aes(y = sweetener, fill = add) ) +
  geom_bar()

#number of added sweeteners by education level
sweet_edu_df2 |>
  ggplot(aes(y = education_level), fill = add, color = "blue") +
  geom_bar()
```
These graphs show the distributions for each variable, so we can get an idea of the different groups we are working with. We see that granulated_sugar is the most popular sweetener, and people with higher than a Bachelor's degree are more common in this sample, which could potentially skew results. Next, we see how these two variables are related to each other through proportions, where we can more directly compare the visual differences.

```{r}

#sweetener preference proportions by education level
sweet_edu_df2 |>
  ggplot(aes(y = sweetener, fill = add) ) +
  geom_bar(position = "fill") +
  facet_wrap(.~education_level)

#proportion preferring sweetener by education level
sweet_edu_df2 |>
  ggplot(aes(y = education_level, fill = add) ) +
  geom_bar(position = "fill") +
  facet_wrap(.~sweetener)

#number of sugar type by education
sweet_edu_df_analysis |>
  ggplot(aes(x = sweet_count, fill = education_level)) +
  geom_bar(position = "dodge")




```
The visualizations for the proportions seem to show little difference between the distribution of sugar types preferred by those with a Bachelor's or higher degree compared to that preferred by those with less than  Bachelor's degree. Instead of looking at the types of sweeteners, we can look at the number of sweeteners that a person uses. This can tell us about their taste preferences, and perhaps lead to insights for making a more appealing coffee to that market of users. Seeing the number of sweeteners a person adds gives an indication to their tolerance/preference for sweetness in their coffee. We can answer the question of how many sweeteners someone uses corresponding to education level through the logistic regression below.

```{r}
#| label: log-reg
edu_sweetener_fit1 <- logistic_reg() |>
  fit(education_level ~ sweet_count, data = sweet_edu_df_analysis)
tidy(edu_sweetener_fit1)


# edu_sweetener_fit2 <- logistic_reg() |>
#   fit(education_level ~ granulated_sugar, data = sweet_edu_df)
# tidy(edu_sweetener_fit)

```
From the results of the logistical regression model, the negative coefficient for sweet_count reflects a lower probability for people with less than a Bachelor's degree choosing more sugar additive types than a person with a Bachelor's degree or higher would. 


```{r}
# We now address our first question on actual self-perceived coffee experience compared to stated preferences. We use examples of people stating their preferences and look at the difference in data where they have a taste test.
```

*Research Question 1*

How does coffee preference and consumption habits differ by demographic attributes? We will look into several factors such as age, gender, education level, race, and political identity. To do this we cleaned the data in a manner that preserves variables related to coffee preference, consumption habits and demographic indicators. 

This Descriptive Analysis attempts to visually represents each variables and their relations to coffee.
```{r}
#|fig-width: 5
#| fig-height: 5
# Preference by Age
roast_totals <- coffee_clean_factors |>
  group_by(roast_level) |>
  summarise(total = n())

#Preferences by gender (may need to standardize by frequencies of gender cause what if more males than females etc.)
coffee_clean_factors |>
  select(gender, cups_of_coffee_per_day) |>
  drop_na() |>
  ggplot(aes(x = cups_of_coffee_per_day, fill = gender)) +
  geom_bar(position= "stack")

#Preferences by Employment per coffees per day
coffee_clean_employ= coffee_clean|>
  mutate(employment_status = ifelse(is.na(employment_status), "No disclosure", employment_status))
ggplot(coffee_clean_employ, aes(x = cups_of_coffee_per_day, y = employment_status)) +
  geom_count() +
  labs(title = "Correlation between Coffees per Day and Employment Status",
       x = "Cups of Coffee per Day",
       y = "Employment Status")

#Preferences by education level
coffee_clean_factors |>
  select(caffeine, education_level) |>
  drop_na() |>
  ggplot(aes(x = caffeine, fill = education_level)) +
  geom_bar() +
  labs(title = "Amount of caffeine in coffee by education level")
```

In our analysis we can infer several things according to different variables and fields of participants.

Cups of Coffee per day by Gender: The visuals suggests that people that identify as males are the highest counts of coffee drinkers per day.In all counts they drink less than 1 and more than 4.

Cups of Coffee per day by employment: From this we can infer that Employed  fulltime individuals are the most frequent coffee drinkers, with at least 2 cups per day for 900 counts of employed individuals. On the opposite side homemakers are recorded to have the least counts of coffee cups.

Caffeine preference per education level: In this visual we can see that the individuals with bachelors degrees that have full caffeine in their coffee are the most common entry. But they are also the most common entry in terms of decaf. A more insightful observation suggests that educational levels are not a pure indicator of the levels of caffeination in participants coffees.

# Evaluation of significance

*Pre-registered Hypothesis 1*

We can investigate if the difference in proportions of preferring a lighter roast between age groups is statistically significant or not with a chi-squared test of independence.

```{r}
#| label: show-independence-relationship
young_roast_binary <-young_roast_reg |>
  mutate(roast_level_binary = fct_collapse(
.f = roast_level,
Lighter = c("Light", "Medium", "Nordic"),
other_level = "Darker"))
  ggplot(young_roast_binary, mapping = aes(x = age, fill = roast_level_binary)) +
  geom_bar(position = "fill") +
    scale_fill_viridis_d() +
    theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

If there were no relationship between these two variables, we would expect to see the purple bars reaching to the same height, regardless of age group. We need to conduct a chi-squared test of independence to see if the differences we see here are just random noise or a meaningful relationship.

Null hypothesis: There is no association between age group and a lighter roast level preference.

Alternative hypothesis: There is an association between age group and a lighter roast level preference.

```{r}
#| label: chi-sqr-test
#source: https://infer.netlify.app/articles/chi_squared
# calculate the observed statistic
observed_indep_statistic <- young_roast_binary %>%
  specify(roast_level_binary ~ age) %>%
  hypothesize(null = "independence") %>%
  calculate(stat = "Chisq")

# generate the null distribution using randomization
null_dist_roast <- young_roast_binary %>%
  specify(roast_level_binary ~ age) %>%
  hypothesize(null = "independence") %>%
  generate(reps = 5000, type = "permute") %>%
  calculate(stat = "Chisq")

# visualize the null distribution and test statistic!
null_dist_roast %>%
  visualize() + 
  shade_p_value(observed_indep_statistic,
                direction = "greater")

# calculate the p value from the observed statistic and null distribution
p_value_independence <- null_dist_roast %>%
  get_p_value(obs_stat = observed_indep_statistic,
              direction = "greater")

p_value_independence

```

*Hypothesis 2*

To evaluate whether the number of types of sweetener accepted differ between people with different education degrees, we will conduct a two-side hypothesis test

Null hypothesis: The true average number of types of sweetener preferred is the same between people in America with a Bachelor's degree or higher and people without a Bachelor's degree.


$$ H_0: \mu_{\text{bach}} - \mu_{\text{no bach}} = 0 $$

Alternative hypothesis: The true average number of types of sweetener preferred is not the same between people in America with a Bachelor's degree or higher and people without a Bachelor's degree.

$$ H_a: \mu_{\text{bach}} - \mu_{\text{no bach}} \neq 0 $$



```{r}
#| label: 2sample-statistics
sweet_edu_df_analysis |>
  group_by(education_level) |>
   summarize(mean = mean(sweet_count))
```
The observed statistic is 1.455-1.408 = 0.047

```{r}
#Hypothesis testing

ob_sweet <- sweet_edu_df_analysis |>
  specify(response = sweet_count, explanatory = education_level) |>
  hypothesize(null = "independence") |>
  calculate(stat = "diff in means")

# null distribution
null_dist_sweet <- sweet_edu_df_analysis |>
  specify(response = sweet_count, explanatory = education_level) |>
  hypothesize(null = "independence") |>
  generate(reps = 1000, type = "permute") |>
  calculate(stat = "diff in means")

# visualize the null distribution and test statistic
null_dist_sweet |>
  visualize() + 
  shade_p_value(ob_sweet,
                direction = "greater")

# calculate the p value from the observed statistic and null distribution
p_value <- null_dist_sweet |>
  get_p_value(obs_stat = ob_sweet,
              direction = "greater")

p_value
```


*Research Question 1*

*Narrowing to Coffee Consumption by Gender*

Research Focus: We saw in the data analysis section that there seems to be a clear relationship between gender and cups of coffee consumed per day. We can focus on the genders with the most data for better results - male and females. To assess whether there's a significant difference in the number of cups of coffee consumed per day across these genders, we can conduct an independent two sample t-test using the group means. This is an appropriate test since we want an average for two groups with different variances (male data is larger than female data)

Null Hypothesis (H0): Males and Females consume the same average number of cups of coffee per day.

$$ H_0: \mu_{\text{Male}} - \mu_{\text{Female}} = 0 $$

Alternative Hypothesis (Ha): There is a difference in the average number of cups of coffee consumed per day between Male and Female.
$$ H_0: \mu_{\text{Male}} - \mu_{\text{Female}} \neq 0 $$
We'll proceed with an independent two-sample t-test to compare the average number of cups of coffee consumed per day between male and female groups.

```{r}
library(dplyr)
# Convert 'cups_of_coffee_per_day' to numeric, handling NAs
coffee_clean_factors <- coffee_clean_factors %>%
  mutate(cups_of_coffee_per_day = as.character(cups_of_coffee_per_day)) %>%
  mutate(cups_of_coffee_per_day = as.numeric(cups_of_coffee_per_day)) %>%
  filter(!is.na(cups_of_coffee_per_day))

# Separate the data by gender for t-test comparison
male_coffee <- coffee_clean_factors %>%
  filter(gender == "Male") %>%
  pull(cups_of_coffee_per_day)

female_coffee <- coffee_clean_factors %>%
  filter(gender == "Female") %>%
  pull(cups_of_coffee_per_day)

t_test_results <- t.test(male_coffee, female_coffee)

print(t_test_results)
```


# Interpretation and conclusions

*Hypothesis 1*

According to the evaluation of significance, we can reject the null hypothesis because our p-value of approximately 0 is less than the alpha value of 0.05. Thus, there is sufficient evidence that there is an association between age group and preferring lighter roasts of coffee. A possible explanation for this phenomenon is that certain age groups are more prone to enjoying a certain taste, while others prefer the caffeine. In the future, we could analyze the the columns specifying people's reason for enjoying coffee versus their age group to explore this hypothesis.

In the data analysis, a possible explanation for younger people showing more of a preference for Dark roasts than Nordic roasts, despite showing an overwhelming preference for Light and Medium roasts, is that more people may be unfamiliar with what a Nordic roast is. For people with general coffee knowledge, seeing light, medium, and dark roasts tends to be more common than Nordic; however, we should still consider that this sample likely has many respondents that are knowledgeable about coffee. So, these results still may have another underlying cause and reveal something about younger people's coffee preferences.

*Hypothesis 2*

The hypothesis test resulted in a p-value of 0.35, which is larger than the critical value of 0.05. This high p-value indicates that we do not have sufficient evidence to reject the null hypothesis. Therefore, we conclude that the observed difference in the number of sweeteners used by individuals with and without a Bachelor's degree is not statistically significant. It is possible for the lower education level group to have a more skewed average because of their much smaller sample size, and thus larger variability.

Given the lack of statistical significance, any observed differences in sweetener use between the two educated groups are likely attributable to random variability rather than the true underlying effect of education on sweetener diversity. This finding suggests that factors other than education may play a more critical role in determining the type of sweetener an individual chooses to use.

*Research Question 1*

Based on our pre-registered analysis, we saw that there is indeed a relationship between age group and an aspect of coffee preferences. Another common demographic feature is gender, and we can see if it is related to the amount of coffee someone drinks - another type of coffee preference. The calculated t-statistic is 9.796, which is a measure of the difference between the two sample means relative to the variation in the samples. A higher t-value indicates a greater degree of difference. The p-value is less than 2.2e-16, which is essentially zero for practical purposes. This is far below the commonly used significance level of 0.05, indicating strong evidence against the null hypothesis.

We reject the null hypothesis that there is no difference in the average number of cups of coffee consumed per day between males and females. The data provides strong evidence that males, on average, consume more cups of coffee per day than females. The result is statistically significant with a high degree of confidence. We should consider, however, that this dataset contains mostly males, so the mean for females may not be as representative.

# Limitations

Despite being such a wide variety of people this data is specific to the US and Isolate coffee experiences and preferences common to the US only. Meanwhile, the study relied on data from survey respondents who may have a particular interest in coffee, potentially skewing the results toward those who are more engaged with their dietary choices.

# Acknowledgments

We thank all participants for their contributions to this study and acknowledge the efforts of our research team in collecting and analyzing the data. Their hard work has been instrumental in enhancing our understanding of consumer behavior related to coffee consumption.
