---
title: "Project title"
subtitle: "Exploratory data analysis"
execute:
  echo: true
---

```{r}
library(tidyverse)
library(janitor)
library(dplyr)
library(skimr)
```

# Inserting the dataset on Coffee
```{r}
coffee_df<-read_csv("data/GACTT_RESULTS_ANONYMIZED_v2.csv")
```

# Research question(s)

Research question(s). State your research question (s) clearly.

# Data collection and cleaning

Have an initial draft of your data cleaning appendix. Document every step that takes your raw data file(s) and turns it into the analysis-ready data set that you would submit with your final project. Include text narrative describing your data collection (downloading, scraping, surveys, etc) and any additional data curation/cleaning (merging data frames, filtering, transformations of variables, etc). Include code for data curation/cleaning, but not collection.

1. Renaming variables

```{r}

#remove NA columns
coffee_clean <- coffee_df |>
  select(-contains("flavorings")) |>
  select(-contains("Gender (please specify"))

#new names
#coffee_clean <- coffee_df |>
#  rename_with(~str_extract(.x, '(?<=\\().*?(?=\\))'))


#remove repetitive questions
coffee_clean <- coffee_clean |>
  mutate(`Where do you typically drink coffee?` = NULL) |>
  mutate(`How do you brew coffee at home?` = NULL)|>
  mutate(`On the go, where do you typically purchase coffee?` = NULL) |>
  mutate(`Do you usually add anything to your coffee?` = NULL) |>
  mutate(`What kind of diary do you add?` = NULL) |>
  mutate(`What kind of sugar or sweetener do you add?` = NULL) |>
  mutate(`Why do you drink coffee?` = NULL)


#function to simplify question names
q_simplify <- function(df, col) {
  df |>
    select(contains("Where do you typically drink")) |>
    rename_with(~str_extract(.x, '(?<=\\().*?(?=\\))'))
}

original_names <- colnames(coffee_clean)
tidy_names <- gsub(" ", "_", original_names)
tidy_names <- tolower(tidy_names)
tidy_names <- gsub("[[:punct:]]&&[^_]", "", tidy_names)

colnames(coffee_clean) <- tidy_names

coffee_clean <- coffee_clean |>
  rename(
    age = "what_is_your_age?",
    cups_of_coffee_per_day = "how_many_cups_of_coffee_do_you_typically_drink_per_day?",
    how_else_at_home = "how_else_do_you_brew_coffee_at_home?",
    where_else_purchase_coffee = "where_else_do_you_purchase_coffee?",
    favorite_coffee_drink = "what_is_your_favorite_coffee_drink?",
    favorite_coffee = "please_specify_what_your_favorite_coffee_drink_is", 
    prefer_between_abc = "between_coffee_a,_coffee_b,_and_coffee_c_which_did_you_prefer?", 
    other_flavoring = "what_other_flavoring_do_you_use?", 
    best_described_before = "before_today's_tasting,_which_of_the_following_best_described_what_kind_of_coffee_you_like?", 
    like_coffee = "how_strong_do_you_like_your_coffee?", 
    roast_level = "what_roast_level_of_coffee_do_you_prefer?", 
    caffeine = "how_much_caffeine_do_you_like_in_your_coffee?", 
    own_coffee_expertise = "lastly,_how_would_you_rate_your_own_coffee_expertise?", 
    prefer_between_ad = "between_coffee_a_and_coffee_d,_which_did_you_prefer?", 
    favorite_overall_coffee = "lastly,_what_was_your_favorite_overall_coffee?", 
    time_spent_on_equipment = "approximately_how_much_have_you_spent_on_coffee_equipment_in_the_past_5_years?", 
    getting_good_value = "do_you_feel_like_youâ€™re_getting_good_value_for_your_money_with_regards_to_your_coffee_equipment?"
  )

colnames(coffee_clean) <- sapply(colnames(coffee_clean), function(name) {
  if (grepl("where_do_you_typically_drink_coffee", name)) {
    name <- gsub("where_do_you_typically_drink_coffee\\?_\\((.*)\\)", "drink_\\1", name)
  } else if (grepl("how_do_you_brew_coffee_at_home", name)) {
    name <- gsub("how_do_you_brew_coffee_at_home\\?_\\((.*)\\)", "at_home_\\1", name)
  } else if (grepl("on_the_go,_where_do_you_typically_purchase_coffee", name)) {
    name <- gsub("on_the_go,_where_do_you_typically_purchase_coffee\\?_\\((.*)\\)", "purchase_\\1", name)
  } else if (grepl("do_you_usually_add_anything_to_your_coffee", name)) {
    name <- gsub("do_you_usually_add_anything_to_your_coffee\\?_\\((.*)\\)", "add_to_\\1", name)
  } else if (grepl("what_kind_of_dairy_do_you_add", name)) {
    name <- gsub("what_kind_of_dairy_do_you_add\\?_\\((.*)\\)", "dairy_add_\\1", name)
  } else if (grepl("what_kind_of_sugar_or_sweetener_do_you_add", name)) {
    name <- gsub("what_kind_of_sugar_or_sweetener_do_you_add\\?_\\((.*)\\)", "sugar_sweetener_add_\\1", name)
  } else if (grepl("why_do_you_drink_coffee", name)) {
    name <- gsub("why_do_you_drink_coffee\\?_\\((.*)\\)", "reason_\\1", name)
  }
  name
}
)

print(colnames(coffee_clean))

#If column is a question true false, keep first word and parentheses content

#if_else("(|)|What|Where|where|How|flavor|?",
#        true,
#        false)
# for example, for column "where do you typically drink coffee (at home)" --> "where_at_home" ;)

#rename_with(insert our function, .cols = everything())


# coffee_clean <- coffee_clean |>
#   select(contains("Where do you typically drink")) |>
#   rename_with(~str_extract(.x, '(?<=\\().*?(?=\\))'))
#   

```

# Data description

Have an initial draft of your data description section. Your data description should be about your analysis-ready data.

# Data limitations

Identify any potential problems with your dataset.

# Exploratory data analysis

Perform an (initial) exploratory data analysis.

# Questions for reviewers

List specific questions for your peer reviewers and project mentor to answer in giving you feedback on this phase.
